#{extends 'main.html' /}
#{set title:post.title /}

#{isMine}
<p id="newPost" class='float-right'>
    <a href="@{Postz.form(post.author.fullname,post.id)}"><span>+</span>&{'EditPost'}</a>
</p>
#{/isMine}

#{if flash.success}
    <p class="success">${flash.success}</p>
#{/if}
 
#{display post:post, as:'full' /}

<ul id="pagination">
    #{if post.previous()}
        <li id="previous">
            <a href="@{Postz.show(post.author.fullname,post.previous().id)}">
                ${post.previous().title}
            </a>
        </li>
    #{/if}
    #{if post.next()}
        <li id="next">
            <a href="@{Postz.show(post.author.fullname,post.next().id)}">
                ${post.next().title}
            </a>
        </li>
    #{/if}
</ul>

&{'PostAComment'} 
#{form @Postz.postComment().add('postId',post.id)}
    #{ifErrors}
        <p class="error">
            ${errors[0]}
        </p>
    #{/ifErrors}
        <table>
    <tr><td id="label"><label>&{'YourName'}</label></td></tr>
    <tr><td><input type="text" name="author" value="${flash.author}"><span id='error'>#{error 'email' /}</span></td></tr>
    <tr><td id="label"><label>&{'YourMessage'} </label></td></tr>
    <tr><td><textarea name="content" id="content">${flash.content}</textarea><span id='error'>#{error 'content' /}</span></td></tr>
    <tr><td id="label"><label>&{'PleaseTypeTheCodeBelow'}</label></td></tr>
    <tr><td id="label"><img src="@{Postz.captcha(randomID)}" /></td></tr>
    <tr><td><input type="text" name="code" id="code" size="18" value="" /><span id='error'>#{error 'code' /}</span></td></tr>
    <tr><td id="info">&nbsp;</td></tr>
    <input type="hidden" name="randomID" value="${randomID}" />
        </table>
    <p>
        <input class='button' type="submit" value="&{'SubmitYourComment'}" />
    </p>
#{/form}
<script type="text/javascript" charset="utf-8">
    $(function() {         
        // Expose the form 
        $('form').click(function() { 
            $('form').expose({api: true}).load(); 
        }); 
        
        // If there is an error, focus to form
        if($('form .error').size()) {
            $('form').expose({api: true, loadSpeed: 0}).load(); 
            $('form input').get(0).focus();
        }
    });
</script>


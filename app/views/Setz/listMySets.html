<div id='setlist'>
选择一个已有相片集，或是为它新建一个相片集
<script>
		function addPhotoToSets(setid,photoid){
			$.post('@{Setz.addPhotoToSets()}',{setsId:setid,photoId:photoid},function(){
				if ($("#nicemenu").length != 0) {
					$("#nicemenu span.head_menu").removeClass('active');
					$("#nicemenu div.sub_menu").hide();				
				}
			});						
		}
		function removePhotoFromSets(setid,photoid){
			$.post('@{Setz.removePhotoFromSets()}',{setsId:setid,photoId:photoid},function(){
				if ($("#nicemenu").length != 0) {
					$("#nicemenu span.head_menu").removeClass('active');
					$("#nicemenu div.sub_menu").hide();				
				}
			});			
		}
		function createNewset(bt){
			var url = $(bt).closest('form').attr('action');
			$.post(url, {username:$('#username').val(),newset:$('#newset').val()}, function(ret){
				$.post('@{Setz.addPhotoToSets()}',{setsId:ret,photoId:${photoId}});
				if ($("#nicemenu").length != 0) {
					$("#nicemenu span.head_menu").removeClass('active');
					$("#nicemenu div.sub_menu").hide();				
				}
			},'JSON'); 
		}
</script>
<table>
#{list items:sets, as:'s'}
	%{def hasadded = (s.photos.contains(photo))}%
	<tr><td>#{if !hasadded }<a href="javascript:addPhotoToSets(${s.id},${photoId})">${s.name}</a>#{/if} #{if hasadded} ${s.name} #{/if}</td>
	<td>#{if hasadded }<a href="javascript:removePhotoFromSets(${s.id},${photoId});">移除</a>#{/if}</td></tr>
#{/list}
</table>
#{form @Setz.newset() }	
	<input type='hidden' id='username' value='${username}'/>
	新相片集:<input type='text' id='newset'><input type='button' onclick='createNewset(this)' class='button' value='创建'>
#{/form}
</div>